# Default values for shared-clamav.

image:
  pullPolicy: IfNotPresent
  # Overwrite these in your values-prod.yaml
  consumer:
    repository: registry.aether.internal:10443/aether-platform/ncs-scalable-virusscanner-consumer
    tag: latest
  producer:
    repository: registry.aether.internal:10443/aether-platform/ncs-scalable-virusscanner-producer
    tag: latest
  clamav:
    repository: registry.aether.internal:10443/clamav/clamav
    tag: latest

redis:
  enabled: true
  auth:
    enabled: false # Experiment/Internal use only. Enable for prod.
  master:
    persistence:
      enabled: false # Ephemeral queue for now
  metrics:
    enabled: true # Enable redis-exporter

resources:
  scanner:
    requests:
      cpu: "100m"
      memory: "128Mi"
    limits:
      cpu: "500m"
      memory: "512Mi"
  clamav:
    requests:
      cpu: "200m"
      memory: "1Gi"
    limits:
      cpu: "1000m"
      memory: "2Gi"
  producer:
    requests:
      cpu: "100m"
      memory: "256Mi"
    limits:
      cpu: "500m"
      memory: "512Mi"

storage:
  pvc:
    name: shared-virusscan-pvc
    size: 10Gi
    # IMPORTANT: Must support ReadWriteMany (RWX)
    # storageClass: "nfs-client"
    storageClass: "" # Leave empty to use default, but ensure it supports RWX or manual binding
    accessMode: ReadWriteMany

service:
  # Bridge is external
  metricsPort: 8080
  producer:
    grpcPort: 50051
    metricsPort: 8080
  consumer:
    metricsPort: 9090

config:
  scanFileThresholdMb: 10
  minFreeMemoryMb: 500
  tenantId: "default-tenant"
  consoleApiUrl: "http://aether-console:3000"

clamav:
  freshclam:
    checksPerDay: 12 # Update virus definitions 12 times per day

envoy:
  image:
    repository: envoyproxy/envoy
    tag: v1.35-latest
  logLevel: info
  caCertSecret: "egress-ca-tls"

autoscaling:
  enabled: true
  minReplicas: 0
  maxReplicas: 10
  # KEDA triggers
  redis:
    host: "{{ .Release.Name }}-redis-master"
    port: 6379
    listLength: 5 # Target backlog per replica
